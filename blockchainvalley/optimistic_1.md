# Optimistic Rollup

## 1. Optimistic Rollup이란 무엇인가

Optimistic Rollup은 이더리움 블록체인의 확장성 문제를 해결하기 위해 제안된 레이어2 기술로, 오프체인에서 다수의 트랜잭션을 처리한 뒤 그 결과만 요약하여 이더리움 메인넷에 게시함으로써 처리량을 크게 높이는 솔루션입니다.

‘롤업(rollup)’이라는 이름처럼 여러 트랜잭션을 한데 모아 **배치(batch)**로 메인체인에 올리기 때문에, 개별 트랜잭션당 필요한 가스 비용을 크게 줄일 수 있고 네트워크 처리 속도를 향상시킵니다.

Optimistic Rollup은 사이드체인 등 다른 확장 솔루션과 달리, 트랜잭션 데이터를 이더리움 체인에 기록하여 이더리움의 보안성을 이어받는 특징이 있습니다.

또한 **옵티미스틱(optimistic)**이라는 이름대로 모든 트랜잭션이 유효하다고 낙관적으로 가정하고 진행하며, 별도의 유효성 증명(예: zkSNARK와 같은 ZK-proof)을 즉시 제출하지 않는 대신 사후에 문제가 발견될 경우 **사기 증명(Fraud Proof)**을 통해 잘못된 거래를 적발하고 처리하는 메커니즘을 갖추고 있습니다.

---

## 2. 기존 레이어1의 문제점과 Rollup의 해결 방안

이더리움과 같은 레이어1 블록체인은 탈중앙화를 유지하기 위해 **처리량(throughput)**에 제한을 두고 있습니다. 모든 노드가 모든 트랜잭션을 검증해야 하므로 초당 처리할 수 있는 트랜잭션 수가 상대적으로 적고, 네트워크 혼잡 시 **거래 수수료(gas fee)**가 급격히 상승하며 **처리 지연(latency)**도 커집니다.

실제로 디파이(DeFi)나 NFT 붐 동안 이더리움 수수료가 폭등하고 거래 확인이 지연되는 문제가 발생했는데, 이는 레이어1의 확장성 한계를 드러낸 사례입니다. 롤업(Rollup)은 이러한 문제를 해결하기 위한 레이어2 확장 해법으로, 연산 처리를 메인체인 밖에서 수행하고 결과만 메인체인에 기록함으로써 처리량을 획기적으로 높이고 수수료를 낮춥니다.

여러 거래를 한 번에 묶어 올리기 때문에 비용을 분산시킬 수 있으며, 이 과정에서도 핵심 데이터는 여전히 메인넷에 게시되어 이더리움의 보안과 탈중앙화 속성을 유지합니다.

이러한 구조 덕분에 Optimistic Rollup은 이론적으로 이더리움 대비 10배에서 최대 100배까지의 확장성 향상을 달성할 수 있는 것으로 보고됩니다.

---

## 3. Optimistic Rollup의 작동 원리

### 3.1 트랜잭션 처리 흐름

Optimistic Rollup에서 사용자 거래는 일반적으로 다음 과정을 거쳐 처리됩니다.

- 사용자는 이더리움 메인넷과 유사한 방식으로 레이어2 네트워크의 **시퀀서(Sequencer)**에게 트랜잭션을 전송합니다. 시퀀서는 레이어2에서 거래를 접수하고 자체 멤풀(mempool)에 쌓아둡니다.
- 시퀀서는 일정 시간마다 또는 트랜잭션이 충분히 모일 때 L2에서 해당 트랜잭션들을 실행하여 새로운 **상태(state)**를 계산합니다. 이때 실행되는 환경은 이더리움과 호환되는 별도의 가상 머신(예: Arbitrum VM 또는 Optimism의 OVM)이지만, 개발자와 사용자 입장에서는 이더리움과 동일한 스마트 컨트랙트 및 인터페이스를 사용합니다.
- 시퀀서는 오프체인에서 실행된 여러 트랜잭션 결과를 하나의 롤업 블록으로 묶어 이더리움 메인넷의 롤업 컨트랙트에 제출합니다. 각 트랜잭션의 입력 데이터(콜데이터)를 압축하여 L1에 기록하고, 해당 배치의 최종 상태 루트(State Root)(롤업 체인의 최신 상태를 대표하는 머클 루트)를 함께 포함시켜 게시합니다.
- L1에 기록된 이 데이터와 상태 커밋은 이후 누구나 열람하고 검증할 수 있도록 공개됩니다.
- 이더리움 L1에 롤업 블록이 게시되면, 롤업의 스마트 컨트랙트가 이를 받아 저장하고 해당 블록을 잠정 확정합니다. 즉, L2 상에서는 다음 블록 처리를 이어가지만 L1에서는 일정 챌린지 기간 동안 해당 롤업 블록에 이의 제기가 가능한 검증 대기 상태로 두게 됩니다. 챌린지 기간이 경과하도록 아무 문제 제기가 없으면 롤업 블록은 최종 확정되어 이더리움에 의해 승인됩니다.

### 3.2 상태 커밋 및 Fraud Proof

- 시퀀서는 각 롤업 블록을 L1에 제출할 때 해당 블록 적용 후의 **상태 루트(State Root)**를 함께 게시합니다. 이 상태 루트는 롤업 체인의 전체 상태를 대표하는 머클 루트(Merkle root)로서, 시퀀서가 주장하는 새로운 상태의 요약본입니다.
- 검증자(Verifier) 노드는 L1에 올라온 트랜잭션 데이터를 내려받아 동일한 트랜잭션들을 순차 실행함으로써 스스로 롤업의 상태를 재현할 수 있습니다.
- 검증자가 자체적으로 계산한 상태 루트와 시퀀서가 제출한 상태 루트가 일치하면 이상이 없는 것이지만, 불일치한다면 시퀀서가 잘못된 상태 업데이트를 보고한 것이므로 이에 대한 이의를 제기할 수 있습니다.

이렇게 커밋된 상태의 오류를 지적하고 증명하는 절차를 **Fraud Proof(사기 증명)**이라고 합니다. Fraud Proof가 제출되면 이더리움 메인넷 상의 롤업 컨트랙트(또는 별도의 분쟁 처리 컨트랙트)가 해당 트랜잭션이나 블록을 재실행하여 실제 상태 변화를 검증합니다.

Optimistic Rollup의 사기 증명 과정은 구현체마다 조금 다른데,

- Optimism의 경우 문제가 된 트랜잭션 전체를 L1에서 한 번에 재현하는 **단일 단계 증명**을 사용하고,
- Arbitrum은 긴 트랜잭션도 효율적으로 분쟁 처리하기 위해 실행 과정을 여러 단계로 나눠 검증하는 **다중 단계 상호작용 증명 방식**을 채택했습니다.

어떤 방식이든 Fraud Proof를 통해 시퀀서의 잘못이 입증되면 해당 롤업 블록은 무효화되어 롤업 체인의 상태가 이전 정상 상태로 롤백되고 잘못된 트랜잭션이 제거됩니다.

동시에 부정한 블록을 올린 시퀀서는 사전에 예치한 보증금이 강제로 소각(슬래싱)당하며, 네트워크의 안전을 지킨 검증자(이의제기자)는 보상을 받게 됩니다.

반대로 정해진 기간 내에 아무도 이의를 제기하지 못하면 해당 블록은 올바른 것으로 간주되어 최종 확정되고, 그 이후에는 롤업 상태를 되돌릴 수 없게 됩니다 (즉, 챌린지 기간이 지난 후에는 L1과 마찬가지로 롤업도 변경 불가성이 확보됩니다).

### 3.3 데이터 가용성 처리 방식

Optimistic Rollup에서는 오프체인에서 처리된 트랜잭션의 원본 데이터를 반드시 이더리움 L1 체인에 게시하여 **데이터 가용성(Data Availability)**을 확보합니다.

레이어2 블록의 트랜잭션 목록이나 상태 변화 정보를 L1의 콜데이터(calldata)로 기록하거나, 향후 도입될 데이터 블랍(blob) 형태로 올려둠으로써, 나중에 어떤 참여자라도 해당 데이터를 이용해 롤업의 상태를 검증할 수 있도록 보장하는 것입니다.

이더리움 L1이 데이터의 영구적 저장소 및 공증 역할을 해 주기 때문에, 롤업 운영자가 데이터를 숨기거나 조작하기 어렵고, 데이터 공개가 확보된 상태에서만 롤업의 상태 업데이트가 최종 인정됩니다.

다만 모든 데이터를 온체인에 기록하는 것은 비용이 수반됩니다. 롤업은 트랜잭션 데이터를 최대한 압축하여 올리고 한 번에 많은 거래를 묶어 제출하지만, 데이터 게시에 드는 L1 가스 비용 자체를 완전히 없앨 수는 없습니다.

이를 개선하기 위해 이더리움은 롤업 데이터를 위한 전용 블랍 영역을 제공하는 프로토-댕크샤딩(Protodanksharding, EIP-4844) 업그레이드를 진행 중이며, 향후 롤업의 데이터 게시 비용을 크게 낮출 수 있을 것으로 기대됩니다.

한편 일부 옵티미스틱 롤업 네트워크는 데이터 가용성 확보 방식을 변형하기도 합니다. 예를 들어 Offchain Labs의 Arbitrum Nova는 **데이터 가용성 위원회(DAC)**를 두어 트랜잭션 데이터를 L1 대신 위원회가 보관하도록 함으로써 수수료를 크게 절감하였는데, 이 경우 위원회 구성원 중 적어도 한 명 이상은 정직하게 데이터를 제공한다는 추가 신뢰 가정이 필요합니다.

보안이 특히 중요한 금융 응용의 경우 비용이 다소 들더라도 모든 데이터를 L1에 올리는 롤업 모드를 택하지만, 소셜/게임처럼 트래픽이 많고 수수료에 민감한 경우에는 이러한 위원회 기반 데이터 관리도 현실적인 대안으로 활용되고 있습니다.
